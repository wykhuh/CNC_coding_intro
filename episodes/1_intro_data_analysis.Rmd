---
title: "Intro to Data Analysis"
teaching: 10
exercises: 2
---

:::::::::::::::::::::::::::::::::::::: questions 

- How do we begin to analyze iNaturalist data?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

- Learn how to download data from iNaturalist
- Learn about the various ways to analyze data

::::::::::::::::::::::::::::::::::::::::::::::::


# iNaturalist data

When iNaturalist users add an observation through the iNaturalist app, that data is saved to the iNaturalist database. People can download the iNaturalist data as CSVs.

CSV is a text file format for tabular data. Each line represents one  record. Each column represents a field. The fields are separated by commas.

The iNaturalist CSV has information about:
- the user who made observation
- the location of the observation
- the observed species
- links for photos, videos, sounds

# Instructions to download iNaturalist data 

To download iNaturalist data, you need an account. Visit iNaturalist, and use the site tools to select which observations you want. Then click the download button. You will be taken to a page that lets you pick what fields to include in the downloads. Then click "Create Export". The number of observations and the fields selected will determine how long it will take to create the download. 

To save time and ensure everyone at the workshop has the same data, here is a link to a CSV with iNaturalist City Nature Challenge Los Angeles data from 2013 to 2024. 

More info about  downloading iNaturalist observation data. 

https://help.inaturalist.org/en/support/solutions/articles/151000169670

https://help.inaturalist.org/en/support/solutions/articles/151000170342-how-can-i-download-data-from-inaturalist-

# Analyzing data

It is difficult for people to see any patterns when reading rows after row of text. To make it easier to see patterns, we can use software to analyze tabular data.

1) Spreadsheet programs are computer application that people can use to view, edit, and analyze tabular data. The programs can do calculations and create charts. Examples include Excel and Google Sheets

2) Geographic information system (GIS) are computer application that people can use to view, edit and analyze geographic data. The programs can do  calculations and create maps. Examples include ArcGIS and QGIS.

3) Programming languages allow people to write instructions to tell a computer to do stuff. We write these instructions in the form of code. We can write code to do calculations, create charts, and create maps. Example programming languages include  R, Python, C.

This class uses R because it is a popular language in ecology research and other types of scientific research.

# Example of analyzing iNaturalist data using R


Load iNaturalist data from City Nature Challenge Los Angeles 2013-2023. There are over 170,000 observations.

```{r, message=FALSE}
library(dplyr)
library(ggplot2)
library(readr)

library(sf) # geo
 # library(terra)

library(here)

# library(gt) # tables
# library(webshot2) # save gt tables as images
library(lubridate)

```
```{r}
path = here("data", "raw", "observations-397280.csv")
inat <- read_csv(path)
```

Get the 10 most commonly observed 'species'.

```{r}
top_10 <- inat %>% 
  filter(!is.na(scientific_name)) %>%
  select(common_name, scientific_name) %>% 
  count(common_name, scientific_name, name='count')  %>%
  arrange(desc(count)) %>% 
  slice(1:10) 

top_10
```




Create a bar chart showing the number of observations per year.

```{r}

inat %>% 
  mutate(year = year(observed_on))  %>%
  group_by(year) %>% 
  ggplot(aes(x = year)) +
  geom_bar()

```

Create a map showing all the observations for Western Fence Lizard

https://www.ecologi.st/spatial-r/rdemo.html#converting-a-dataframe-into-a-spatial-object

```{r}
plot_locations <- inat %>%
  filter(!is.na(latitude)) %>%
  filter(!is.na(longitude)) %>%
  filter(latitude < 40) %>%
  mutate(year = year(observed_on))  %>%
  filter(common_name == 'Western Fence Lizard')  %>%
  st_as_sf(coords = c("longitude", "latitude"),   crs = 4326)


plot_locations
```
  
https://www.ecologi.st/spatial-r/rdemo.html#interactive-maps-with-leaflet-and-mapview

```{r}
library(mapview)
library(leafpop)

lpl <- plot_locations %>%
  mutate(click_url = paste("<a href='", url, "'>Link to iNat observation</a>"))


mapview(plot_locations, 
        popup = 
          popupTable(lpl,
            zcol = c("user_login", "year", "click_url")))
```

